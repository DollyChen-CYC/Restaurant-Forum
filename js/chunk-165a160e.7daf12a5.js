(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-165a160e"],{"0648":function(t,e,r){},"26e9":function(t,e,r){},"3ab7":function(t,e,r){"use strict";r("0648")},"498a":function(t,e,r){"use strict";var a=r("23e7"),n=r("58a8").trim,s=r("c8d2");a({target:"String",proto:!0,forced:s("trim")},{trim:function(){return n(this)}})},7726:function(t,e,r){"use strict";r("fc0f")},"89a0":function(t,e,r){"use strict";r("26e9")},ad68:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"container py-5"},[r("restaurant-detail",{attrs:{"initial-restaurant":t.restaurant}}),r("hr"),r("restaurantComments",{attrs:{"restaurant-comments":t.restaurant.restaurantComments,"is-deleting":t.isDeleteing},on:{"after-delete-comment":t.afterDeleteComment}}),r("create-comment",{attrs:{"restaurant-id":t.restaurant.id,"is-posting":t.isPosting},on:{"after-create-comment":t.afterCreateComment}})],1)},n=[],s=r("1da1"),i=r("5530"),o=(r("96cf"),r("b0c0"),r("a4d3"),r("e01a"),r("4de4"),r("d3b7"),r("c4c3")),u=r("2fa3"),c={createRestaurantComment:function(t){var e=t.RestaurantId,r=t.UserId,a=t.text;return u["b"].post("/comments",{RestaurantId:e,UserId:r,text:a})},deleteRestaurantComment:function(t){var e=t.commentId;return u["b"].delete("/comments/".concat(e))}},m=r("2f62"),l=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"row"},[r("div",{staticClass:"col-md-12 mb-3"},[r("h1",[t._v(t._s(t.restaurant.name))]),r("p",{staticClass:"badge bg-primary mt-1 mb-3"},[t._v(" "+t._s(t.restaurant.categoryName)+" ")])]),r("div",{staticClass:"col-lg-4"},[r("img",{staticClass:"img-responsive center-block rounded-3",staticStyle:{width:"250px","margin-bottom":"25px"},attrs:{src:t.restaurant.image}}),r("div",{staticClass:"contact-info-wrap"},[r("ul",{staticClass:"list-unstyled"},[r("li",[r("strong",[t._v("Opening Hour:")]),t._v(" "+t._s(t.restaurant.openingHours)+" ")]),r("li",[r("strong",[t._v("Tel:")]),t._v(" "+t._s(t.restaurant.tel)+" ")]),r("li",[r("strong",[t._v("Address:")]),t._v(" "+t._s(t.restaurant.address)+" ")])])])]),r("div",{staticClass:"col-lg-8"},[r("p",{staticClass:"text-secondary"},[t._v(t._s(t.restaurant.description))]),r("router-link",{staticClass:"btn me-2 btn-primary btn-border mr-2",attrs:{to:{name:"restaurant-dashboard",params:{id:t.restaurant.id}}}},[t._v("Dashboard")]),t.restaurant.isFavorited?r("button",{staticClass:"btn me-2 btn-danger btn-border mr-2",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.removeFavorite.apply(null,arguments)}}},[t._v(" 移除最愛 ")]):r("button",{staticClass:"btn me-2 btn-primary btn-border mr-2",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.addFavorite.apply(null,arguments)}}},[t._v(" 加到最愛 ")]),t.restaurant.isLiked?r("button",{staticClass:"btn me-2 btn-danger like mr-2",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.removeLike.apply(null,arguments)}}},[t._v(" Unlike ")]):r("button",{staticClass:"btn me-2 btn-primary like mr-2",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.addLike.apply(null,arguments)}}},[t._v(" Like ")])],1)])},d=[],p=r("4cce"),f={props:{initialRestaurant:{type:Object,requried:!0}},data:function(){return{restaurant:this.initialRestaurant}},watch:{initialRestaurant:function(t){this.restaurant=Object(i["a"])(Object(i["a"])({},this.restaurant),t)}},methods:{addFavorite:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var r,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,r=t.restaurant.id,e.next=4,p["a"].addFavorite({restaurantId:r});case 4:if(a=e.sent,n=a.data,"success"===n.status){e.next=8;break}throw new Error(n.message);case 8:t.restaurant.isFavorited=!0,e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](0),u["a"].fire({icon:"error",title:"目前無法加入最愛，請稍後再試"});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))()},removeFavorite:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var r,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,r=t.restaurant.id,e.next=4,p["a"].removeFavorite({restaurantId:r});case 4:if(a=e.sent,n=a.data,"success"===n.status){e.next=8;break}throw new Error(n.message);case 8:t.restaurant.isFavorited=!1,e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](0),u["a"].fire({icon:"error",title:"無法移除最愛，請稍後再試"});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))()},addLike:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var r,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,r=t.restaurant.id,e.next=4,p["a"].addLike({restaurantId:r});case 4:if(a=e.sent,n=a.data,"success"===n.status){e.next=8;break}throw new Error(n.message);case 8:t.restaurant.isLiked=!0,e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](0),u["a"].fire({icon:"error",title:"目前無法按讚，請稍後再試"});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))()},removeLike:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var r,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,r=t.restaurant.id,e.next=4,p["a"].deleteLike({restaurantId:r});case 4:if(a=e.sent,n=a.data,"success"===n.status){e.next=8;break}throw new Error(n.message);case 8:t.restaurant.isLiked=!1,e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](0),u["a"].fire({icon:"error",title:"目前無法移除讚，請稍後再試"});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))()}}},v=f,b=(r("3ab7"),r("2877")),h=Object(b["a"])(v,l,d,!1,null,"1148bdbe",null),g=h.exports,C=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("h2",{staticClass:"my-4"},[t._v("所有評論：")]),t._l(t.restaurantComments,(function(e){return r("div",{key:e.id},[r("blockquote",{staticClass:"blockquote mb-0"},[t.currentUser.isAdmin?r("button",{staticClass:"btn btn-danger float-end",attrs:{type:"button",disabled:t.isDeleting},on:{click:function(r){return r.stopPropagation(),r.preventDefault(),t.handleDeleteButtonClick(e.id)}}},[t._v(" Delete ")]):t._e(),r("h3",[r("router-link",{attrs:{to:{name:"user",params:{id:e.User.id}}}},[t._v(" "+t._s(e.User.name)+" ")])],1),r("p",[t._v(t._s(e.text))]),r("footer",{staticClass:"blockquote-footer mt-1"},[t._v(" "+t._s(t._f("fromNow")(e.createdAt))+" ")])]),r("hr")])}))],2)},k=[],w=r("2708"),x={props:{restaurantComments:{type:Array,default:function(){return[]}},isDeleting:{type:Boolean,default:!1}},mixins:[w["c"]],data:function(){return{}},computed:Object(i["a"])({},Object(m["b"])(["currentUser"])),methods:{handleDeleteButtonClick:function(t){this.$emit("after-delete-comment",t)}}},_=x,R=(r("89a0"),Object(b["a"])(_,C,k,!1,null,"39ad4897",null)),y=R.exports,D=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("form",{on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),t.handleSubmit.apply(null,arguments)}}},[r("div",{staticClass:"form-group mb-4"},[r("label",{attrs:{for:"text"}},[t._v("留下評論：")]),r("textarea",{directives:[{name:"model",rawName:"v-model",value:t.inputComment,expression:"inputComment"}],staticClass:"form-control mt-2",attrs:{rows:"3",name:"text"},domProps:{value:t.inputComment},on:{input:function(e){e.target.composing||(t.inputComment=e.target.value)}}})]),r("div",{staticClass:"d-flex align-items-center justify-content-between"},[r("button",{staticClass:"btn btn-link",attrs:{type:"button"},on:{click:function(e){return t.$router.back()}}},[t._v(" 回上一頁 ")]),r("button",{staticClass:"btn btn-primary mr-0",attrs:{type:"submit",disabled:t.isPosting}},[t._v(" Submit ")])])])},I=[],O=(r("a9e3"),r("498a"),{props:{restaurantId:{type:Number,required:!0},isPosting:{type:Boolean,default:!1}},data:function(){return{inputComment:""}},methods:{handleSubmit:function(){0!==this.inputComment.trim().length?(this.$emit("after-create-comment",{restaurantId:this.restaurantId,text:this.inputComment}),this.inputComment=""):u["a"].fire({icon:"warning",title:"請輸入留言內容"})}}}),j=O,U=(r("7726"),Object(b["a"])(j,D,I,!1,null,"6908fa7b",null)),L=U.exports,P={name:"Restaurant",components:{RestaurantDetail:g,RestaurantComments:y,CreateComment:L},data:function(){return{restaurant:{id:-1,name:"",categoryName:"",image:"",openingHours:"",tel:"",address:"",description:"",restaurantComments:[],isFavorited:!1,isLiked:!1},isPosting:!1,isDeleteing:!1}},computed:Object(i["a"])({},Object(m["b"])(["currentUser"])),created:function(){var t=this.$route.params.id;this.fetchRestaurant(t)},beforeRouteUpdate:function(t,e,r){var a=t.params.id;this.fetchRestaurant(a),r()},methods:{fetchRestaurant:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,n,s,i,c,m,l,d,p,f,v,b,h,g;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,o["a"].getRestaurant({restaurantId:t});case 3:if(a=r.sent,n=a.data,n.restaurant.name){r.next=7;break}throw new Error("error");case 7:s=n.restaurant,i=n.isFavorited,c=n.isLiked,m=s.id,l=s.name,d=s.Category,p=s.image,f=s.opening_hours,v=s.tel,b=s.address,h=s.description,g=s.Comments,e.restaurant={id:m,name:l,categoryName:d?d.name:"未分類",image:p,openingHours:f,tel:v,address:b,description:h,restaurantComments:g,isFavorited:i,isLiked:c},r.next=15;break;case 12:r.prev=12,r.t0=r["catch"](0),u["a"].fire({icon:"error",title:"無法取得餐廳資料，請稍後再試"});case 15:case"end":return r.stop()}}),r,null,[[0,12]])})))()},afterDeleteComment:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,e.isDeleteing=!0,r.next=4,c.deleteRestaurantComment({commentId:t});case 4:if(a=r.sent,n=a.data,"success"===n.status){r.next=8;break}throw new Error(n.message);case 8:e.restaurant.restaurantComments=e.restaurant.restaurantComments.filter((function(e){return e.id!==t})),e.isDeleteing=!1,r.next=16;break;case 12:r.prev=12,r.t0=r["catch"](0),e.isDeleteing=!1,u["a"].fire({icon:"error",title:"無法刪除評論，請稍後再試"});case 16:case"end":return r.stop()}}),r,null,[[0,12]])})))()},afterCreateComment:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,n,s,i,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,a=t.restaurantId,n=t.text,s=e.currentUser.id,r.next=5,c.createRestaurantComment({UserId:s,RestaurantId:a,text:n});case 5:if(i=r.sent,o=i.data,"success"===o.status){r.next=9;break}throw new Error(o.message);case 9:e.restaurant.restaurantComments.push({id:o.commentId,text:n,UserId:s,RestaurantId:a,createdAt:new Date,User:{id:s,name:e.currentUser.name}}),r.next=15;break;case 12:r.prev=12,r.t0=r["catch"](0),u["a"].fire({icon:"error",title:"無法新增評論，請稍後再試"});case 15:case"end":return r.stop()}}),r,null,[[0,12]])})))()}}},E=P,F=Object(b["a"])(E,a,n,!1,null,null,null);e["default"]=F.exports},c8d2:function(t,e,r){var a=r("5e77").PROPER,n=r("d039"),s=r("5899"),i="​᠎";t.exports=function(t){return n((function(){return!!s[t]()||i[t]()!==i||a&&s[t].name!==t}))}},fc0f:function(t,e,r){}}]);
//# sourceMappingURL=chunk-165a160e.7daf12a5.js.map